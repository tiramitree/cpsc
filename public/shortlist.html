<!-- shortlist.html (字段改为实际数据库字段名，并添加 URL 与无数据提示) -->
<!DOCTYPE html>
<html data-bs-theme="light" lang="en">
<head>
  <meta charset="utf-8">
  <title>Shortlist Recalls</title>
  <link rel="stylesheet" href="assets/bootstrap/css/bootstrap.min.css">
</head>
<body>

<nav class="navbar navbar-expand-md navbar-light bg-light">
  <div class="container">
    <a class="navbar-brand" href="index.html">CPSC Recall Management</a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
            data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent"
            aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ms-auto">
        <li class="nav-item"><a class="nav-link" href="recalls.html">Recalls</a></li>
        <li class="nav-item"><a class="nav-link" href="import-recalls.html">Import</a></li>
        <li class="nav-item"><a class="nav-link active" href="shortlist.html">Shortlist</a></li>
      </ul>
    </div>
  </div>
</nav>

<div class="container mt-4">
  <h2>Shortlist Recalls</h2>
  <form id="shortlistForm" method="POST" action="/api/shortlist">
    <table class="table table-bordered">
      <thead>
        <tr>
          <th>Select</th>
          <th>Recall ID</th>
          <th>Product Name</th>
          <th>Recall Date</th>
          <th>Category</th>
          <th>Priority Status</th>
          <th>URL</th>
        </tr>
      </thead>
      <tbody id="shortlistTableBody">
        <!-- Dynamically populated rows -->
      </tbody>
    </table>
    <button type="submit" id="shortlistBtn" class="btn btn-primary" disabled>Shortlist Selected</button>
  </form>
</div>

<script src="assets/bootstrap/js/bootstrap.min.js"></script>
<script src="bold-and-bright.js"></script>
<script>
  fetch('/api/recalls')
    .then(response => response.json())
    .then(data => {
      const tableBody = document.getElementById('shortlistTableBody');
      if (!data.length) {
        tableBody.innerHTML = '<tr><td colspan="7" class="text-center text-muted">No recall data available.</td></tr>';
        return;
      }
      data.forEach(recall => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td><input type="checkbox" name="selectedRecalls" value="${recall.Recall_ID}"></td>
          <td>${recall.Recall_ID}</td>
          <td>${recall.Product_Name || ''}</td>
          <td>${recall.Recall_Date ? recall.Recall_Date.slice(0,10) : ''}</td>
          <td>${recall.Category || ''}</td>
          <td>${recall.Priority_Status || ''}</td>
          <td><a href="${recall.URL || '#'}" target="_blank">Link</a></td>
        `;
        tableBody.appendChild(tr);
      });

      const checkboxes = document.querySelectorAll('input[name="selectedRecalls"]');
      const submitBtn = document.getElementById('shortlistBtn');

      function updateButtonState() {
        const selected = document.querySelectorAll('input[name="selectedRecalls"]:checked');
        submitBtn.disabled = !(selected.length >= 3 && selected.length <= 5);
      }

      checkboxes.forEach(cb => cb.addEventListener('change', updateButtonState));
    })
    .catch(err => {
      console.error("Failed to load recalls:", err);
    });
</script>

</body>
</html>